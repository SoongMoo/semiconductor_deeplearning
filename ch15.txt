# 환경 설정
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense
from sklearn.model_selection import train_test_split
import pandas as pd
from tensorflow.keras.callbacks import EarlyStopping, ModelCheckpoint
from tensorflow.keras.datasets import mnist

# 데이터 가공 
df = pd.read_csv("./data/house_train.csv")
cols_train=['OverallQual','GrLivArea','GarageCars','GarageArea','TotalBsmtSF']
X = df[cols_train]
y = df['SalePrice'].values

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)
# 모델 구조
model = Sequential()
model.add(Dense(30, input_dim = 12, activation = "relu"))
model.add(Dense(12, activation='relu'))
model.add(Dense(8, activation='relu'))
model.add(Dense(1))
model.summary() # 안해도 됨
#모델 적용
model.compile(loss='mse', optimizer='adam', metrics=['mae'])


# 과적합 오류를 방지, 최적의 모델 저장
early_stopping_callback = EarlyStopping(monitor='val_loss', patience=20)

modelpath = "./data/house.keras"
checkpointer = ModelCheckpoint(filepath=modelpath,monitor='val_loss',verbose=0, save_best_only=True)


# 학습
history=model.fit(X_train, y_train, epochs=2000, batch_size=500
		, validation_split=0.25, verbose=1 
		,callbacks=[early_stopping_callback, checkpointer] )

# 모델을 테스트셋에 적용해 정확도를 구합니다. 
score=model.evaluate(X_test, y_test)
print('Test accuracy:', score[1])


#model.save("./data/wine.keras")
